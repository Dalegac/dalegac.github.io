<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="baidu-site-verification" content="code-U1H8DpArhN" /><meta name="google-site-verification" content="QVDlmvOcs2V_mDGnn3PxxIPUmSY8xhIYTsx5BNyLMR0" /><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://dale-blog-326813.as.r.appspot.com/query?id=ahR6YXN-ZGFsZS1ibG9nLTMyNjgxM3IVCxIIQXBpUXVlcnkYgICAmJSmgwoM"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="深拷贝" /><meta name="author" content="Dale" /><meta property="og:locale" content="en" /><meta name="description" content="1. 需要考虑的问题" /><meta property="og:description" content="1. 需要考虑的问题" /><link rel="canonical" href="https://dalegac.github.io/posts/deepClone/" /><meta property="og:url" content="https://dalegac.github.io/posts/deepClone/" /><meta property="og:site_name" content="Dale" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-05T09:52:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="深拷贝" /><meta name="twitter:site" content="@Dale" /><meta name="twitter:creator" content="@Dale" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Dale"},"dateModified":"2021-10-05T09:52:00+08:00","datePublished":"2021-10-05T09:52:00+08:00","description":"1. 需要考虑的问题","headline":"深拷贝","mainEntityOfPage":{"@type":"WebPage","@id":"https://dalegac.github.io/posts/deepClone/"},"url":"https://dalegac.github.io/posts/deepClone/"}</script><title>深拷贝 | Dale</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Dale"><meta name="application-name" content="Dale"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://dale-blog-326813.as.r.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://dale-blog-326813.as.r.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://github.com/Dalegac/static-pic/blob/master/images/avatar.jpg?raw=true" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dale</a></div><div class="site-subtitle font-italic">A beginner</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Dalegac" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Dale" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jiacange','gmai.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>深拷贝</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>深拷贝</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Dale </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 5, 2021, 9:52 AM +0800" >Oct 5, 2021<i class="unloaded">2021-10-05T09:52:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1066 words">5 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><h2 id="1-需要考虑的问题">1. 需要考虑的问题</h2><ul><li>基本实现<ul><li>递归能力</ul><li>循环引用<ul><li>考虑问题的全面性<li>理解 weakmap 的真正意义</ul><li>多种类型<ul><li>考虑问题的严谨性<li>创建各种引用类型的方法，JS API 的熟练程度<li>准确的判断数据类型，对数据类型的理解程度</ul><li>通用遍历：<ul><li>写代码可以考虑性能优化<li>了解集中遍历的效率<li>代码抽象能力</ul><li>拷贝函数：<ul><li>箭头函数和普通函数的区别<li>正则表达式熟练程度</ul></ul><h2 id="2-实现">2. 实现</h2><div lang="js" class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
</pre><td class="rouge-code"><pre><span class="cm">/*
 * @Author: Dalegac
 * @Date: 2021-09-30 14:28:05
 * @LastEditTime: 2021-10-04 10:11:43
 * @LastEditors: Dalegac
 * @Description: Just say something
 */</span>
<span class="c1">// 可继续遍历的数据类型</span>
<span class="kd">const</span> <span class="nx">mapTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Map]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">setTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Set]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">arrayTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Array]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">objectTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Object]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">argsTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Arguments]</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 不可继续遍历的数据类型</span>
<span class="kd">const</span> <span class="nx">boolTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Boolean]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">dateTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Date]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">numberTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Number]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">stringTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object String]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">symbolTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Symbol]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">bigintTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object BigInt]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">errorTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Error]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">regexpTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object RegExp]</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">funcTag</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[object Function]</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">deepTag</span> <span class="o">=</span> <span class="p">[</span><span class="nx">mapTag</span><span class="p">,</span> <span class="nx">setTag</span><span class="p">,</span> <span class="nx">arrayTag</span><span class="p">,</span> <span class="nx">objectTag</span><span class="p">,</span> <span class="nx">argsTag</span><span class="p">];</span>

<span class="cm">/**
 * @description: 工具函数 - 通用while循环
 * @param {Array}array 待遍历数组
 * @param {Function}iteratee 执行函数
 * @return {Array}
 */</span>
<span class="kd">function</span> <span class="nf">forEach</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">iteratee</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">while </span><span class="p">(</span><span class="o">++</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">iteratee</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">index</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/**
 * @description: 工具函数 - 判断是否为引用类型
 * @param {Any} target
 * @return {Boolean} 是否是引用类型
 */</span>
<span class="kd">function</span> <span class="nf">isObject</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">target</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">target</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">object</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">function</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/**
 * @description: 工具函数 - 获取实际类型
 * @param {Any} target
 * @return {String} 格式化类型
 */</span>
<span class="kd">function</span> <span class="nf">getType</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * @description:工具函数 - 初始化被克隆函数
 * @param {Any} target
 * @return {*}
 */</span>
<span class="kd">function</span> <span class="nf">getInit</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Ctor</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="kd">constructor</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nc">Ctor</span><span class="p">();</span>
<span class="p">}</span>
<span class="cm">/**
 * @description: 工具函数 - 克隆Symbol
 * @param {Symbol}
 * @return {*}
 */</span>
<span class="kd">function</span> <span class="nf">cloneSymbol</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nc">Object</span><span class="p">(</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">target</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/**
 * @description: 工具函数 - 克隆正则
 * @param {Regexp} target
 * @return {*}
 */</span>
<span class="kd">function</span> <span class="nf">cloneReg</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">flags</span><span class="p">,</span> <span class="nx">lastIndex</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RegExp</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">flags</span><span class="p">);</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">lastIndex</span> <span class="o">=</span> <span class="nx">lastIndex</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * @description: 工具函数 - 克隆函数
 * @param {Function} target
 * @return {*}
 */</span>
<span class="kd">function</span> <span class="nf">cloneFunction</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">bodyReg</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(?&lt;</span><span class="sr">={</span><span class="se">)</span><span class="sr">.+</span><span class="se">(?=</span><span class="sr">}</span><span class="se">)</span><span class="sr">/m</span><span class="nx">s</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">paramReg</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(?&lt;</span><span class="sr">=</span><span class="se">\()</span><span class="sr">.+</span><span class="se">(?=\)\s</span><span class="sr">+{</span><span class="se">)</span><span class="sr">/</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">funcString</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nf">toString</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="nx">paramReg</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="nx">funcString</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">bodyReg</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="nx">funcString</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">paramArr</span> <span class="o">=</span> <span class="nx">param</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">,</span><span class="dl">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Function</span><span class="p">(...</span><span class="nx">paramArr</span><span class="p">,</span> <span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Function</span><span class="p">(</span><span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">eval</span><span class="p">(</span><span class="nx">funcString</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * @description: 工具函数 - 克隆不可遍历类型
 * @param {Any} target 被克隆对象
 * @param {String} type 对象类型
 * @return {*}
 */</span>
<span class="kd">function</span> <span class="nf">cloneOtherType</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Ctor</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="kd">constructor</span><span class="p">;</span>
  <span class="k">switch </span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">boolTag</span><span class="p">:</span>
    <span class="k">case</span> <span class="nx">numberTag</span><span class="p">:</span>
    <span class="k">case</span> <span class="nx">stringTag</span><span class="p">:</span>
    <span class="k">case</span> <span class="nx">bigintTag</span><span class="p">:</span>
    <span class="k">case</span> <span class="nx">errorTag</span><span class="p">:</span>
    <span class="k">case</span> <span class="nx">dateTag</span><span class="p">:</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nc">Ctor</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="k">case</span> <span class="nx">regexpTag</span><span class="p">:</span>
      <span class="k">return</span> <span class="nf">cloneReg</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="k">case</span> <span class="nx">symbolTag</span><span class="p">:</span>
      <span class="k">return</span> <span class="nf">cloneSymbol</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="k">case</span> <span class="nx">funcTag</span><span class="p">:</span>
      <span class="k">return</span> <span class="nf">cloneFunction</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * @description: 克隆函数
 * @param {Any} target 被克隆对象
 * @param {WeakMap} map 引用对象缓存池
 * @return {*}
 */</span>
<span class="kd">function</span> <span class="nf">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WeakMap</span><span class="p">())</span> <span class="p">{</span>
  <span class="c1">// 克隆原始类型</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">isObject</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 初始化</span>
  <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nf">getType</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">cloneTarget</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">deepTag</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">cloneTarget</span> <span class="o">=</span> <span class="nf">getInit</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">cloneOtherType</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 防止循环引用</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">map</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">cloneTarget</span><span class="p">);</span>

  <span class="c1">// 克隆set</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">setTag</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cloneTarget</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nf">clone</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">map</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">cloneTarget</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 克隆map</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">mapTag</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cloneTarget</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nf">clone</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">map</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">cloneTarget</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 克隆对象和数组</span>
  <span class="kd">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">===</span> <span class="nx">arrayTag</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
  <span class="nf">forEach</span><span class="p">(</span><span class="nx">keys</span> <span class="o">||</span> <span class="nx">target</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">cloneTarget</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nf">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">map</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">cloneTarget</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">clone</span> <span class="p">};</span>
</pre></table></code></div></div><h2 id="3-参考">3. 参考</h2><ul><li><a href="http://www.conardli.top/blog/article/JS%E8%BF%9B%E9%98%B6/%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E6%83%8A%E8%89%B3%E9%9D%A2%E8%AF%95%E5%AE%98%E7%9A%84%E6%B7%B1%E6%8B%B7%E8%B4%9D.html#%E5%AF%BC%E8%AF%BB">如何写出一个惊艳面试官的深拷贝</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt">MDN BigInt</a><li><a href="https://es6.ruanyifeng.com/#docs/regex#RegExp-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">阮一峰博客 ES6 RegExp</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/javascript/'>JavaScript</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/javascript/" class="post-tag no-text-decoration" >JavaScript</a> <a href="/tags/%E6%B7%B1%E6%8B%B7%E8%B4%9D/" class="post-tag no-text-decoration" >深拷贝</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=深拷贝 - Dale&url=https://dalegac.github.io/posts/deepClone/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=深拷贝 - Dale&u=https://dalegac.github.io/posts/deepClone/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=深拷贝 - Dale&url=https://dalegac.github.io/posts/deepClone/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/enterprise-level-large-file-upload/">企业级大文件上传</a><li><a href="/posts/what's-is-fiber/">What is Fiber</a><li><a href="/posts/javasript-array-methods/">JavaScript数组方法</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/vue/">Vue</a> <a class="post-tag" href="/tags/array/">Array</a> <a class="post-tag" href="/tags/fiber/">fiber</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/nodejs/">Nodejs</a> <a class="post-tag" href="/tags/nvm/">nvm</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/vuejs%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">Vuejs设计与实现</a> <a class="post-tag" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/javasript-array-methods/"><div class="card-body"> <span class="timeago small" >Sep 26, 2021<i class="unloaded">2021-09-26T11:16:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JavaScript数组方法</h3><div class="text-muted small"><p> 1. 数组的声明 1.1 数组文本 使用数组文本是创建 JavaScript 数组最简单的方法。 var array-name = [item1, item2, ...]; 空格和折行并不重要，声明可横跨多行。 请不要最后一个元素之后写逗号，比如： var guns = ["AWM","98Kar","Uzi",] 可能存在跨浏览器兼容性问题。 1.2 使用 JavaScr...</p></div></div></a></div><div class="card"> <a href="/posts/preliminary-understanding-to-render/"><div class="card-body"> <span class="timeago small" >Mar 26, 2022<i class="unloaded">2022-03-26T09:52:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>初识渲染器-创建篇</h3><div class="text-muted small"><p> 1. 前置知识 1.1 UI 内容 DOM 元素：例如是 div 标签还是 a 标签。 属性：如 a 标签的 href 属性，再如 id、class 等通用属性。 事件：如 click、keydown 等。 元素的层级结构：DOM 树的层级结构，既有子节点，又有父节点。 1.2 UI 的描述方式 模板描述 1 &lt;h1 @click="handler...</p></div></div></a></div><div class="card"> <a href="/posts/what's-is-fiber/"><div class="card-body"> <span class="timeago small" >Sep 9, 2021<i class="unloaded">2021-09-09T17:21:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>What is Fiber</h3><div class="text-muted small"><p> 1. 设计理念 1.1 React 哲学 我们认为，React 是用 JavaScript 构建快速响应的大型 Web 应用程序的首选方式。他在 Facebook 和 Instagram 上表现优秀。 1.1.1 制约快速响应的因素 计算能力——CPU 瓶颈(creating nodes,re-rendering) 网络延迟——IO 瓶颈(data fetching...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/javasript-array-methods/" class="btn btn-outline-primary" prompt="Older"><p>JavaScript数组方法</p></a> <a href="/posts/enterprise-level-large-file-upload/" class="btn btn-outline-primary" prompt="Newer"><p>企业级大文件上传</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/Dale24745082">Dale</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/vue/">Vue</a> <a class="post-tag" href="/tags/array/">Array</a> <a class="post-tag" href="/tags/fiber/">fiber</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/nodejs/">Nodejs</a> <a class="post-tag" href="/tags/nvm/">nvm</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/vuejs%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">Vuejs设计与实现</a> <a class="post-tag" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dalegac.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B0741WGFCY"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B0741WGFCY'); }); </script>
